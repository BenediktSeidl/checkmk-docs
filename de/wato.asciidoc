= Die Konfiguration von Checkmk
:revdate: 2016-03-02
[.seealso][#cmk_commandline] [#wato_hosts] [#wato_rules]:title: WATO - Die Checkmk Konfigurationsoberfläche
:description: Checkmk ermöglicht die gesamte Basiskonfiguration direkt in der Weboberfläche. Dieser Artikel bietet einen ersten Einstieg in dieses wichtige Modul.

== Einleitung

image::bilder/watosnapin.png[align=left,right]

(CMK) unterscheidet zwischen der *Konfigurationsumgebung,* in der
Sie die Hosts, Services und Einstellungen verwalten, und dem eigentlichen
*Monitoring,* in der dem operative Überwachung stattfindet.
<br><br>
Änderungen in der Konfiguration -- z.B. das Hinzufügen eines neuen Hosts --
haben zunächst keinen Einfluss auf das Monitoring.  Erst durch ein
[.guihints]#Activate Changes# werden alle Änderungen, die Sie seit dem letzten Mal
angesammelt haben, gleichzeitig aktiv. Vielleicht mag Ihnen das umständlich
erscheinen. Es hat aber den Vorteil, dass Sie eine komplexere Änderung erst
in Ruhe vorbereiten können, bevor diese produktiv geht. So kann es z.B. sein,
dass Sie nach dem Hinzufügen eines Hosts erst noch Schwellwerte setzen oder
manche Services entfernen möchten, bevor das Ganze „scharfgeschaltet“
werden soll.
<br><br>
Das Werkzeug für das Konfigurieren von Checkmk per GUI heißt [.guihints]#WATO}}# 
[.guihints]#(Web Administration Tool).# WATO verwaltet alle Konfi&shy;gurationen in
handlichen Textdateien, welche erfahrene Benutzer auch von Hand
editieren oder sogar per Skript erzeugen können.
WATO erreichen Sie über das entsprechende Element in der Seitenleiste. Dieses
Element ist standardmäßig eingebunden und bietet direkten Zugriff auf alle
WATO-Module.
<br><br>
Wann immer Sie per WATO eine Änderung an der Monitoring-Konfiguration machen,
wird diese zunächst gesammelt und gilt als [.guihints]#pending.# Sie erkennen
solche Änderungen an dem Knopf ICON[button_2_changes.png] in den
WATO-Modulen bzw. an dem Knopf ICON[wato_changes.png] in der Seitenleiste.
Diese beiden Knöpfe bringen Sie zu einer Liste dieser Änderungen:

image::bilder/wato_pending_log.png[align=border]

Durch Klick auf den Knopf [.guihints]#Activate Changes# wird nun aus Konfigurationsdateien von
WATO eine neue Konfiguration für den Monitoring-Kern erzeugt und diesem
der Befehl gegeben, diese ab sofort zu verwenden:

image::bilder/wato_activate_changes.png[align=center,width=400]

Die Liste der anstehenden Änderungen wird dadurch geleert. Diese Einträge sind aber
nicht verloren, sondern können über [.guihints]#Audit Log# abgerufen werden. Dort
finden Sie eine Logdatei von allen Änderungen, die per WATO jemals gemacht wurden.


### H1:Snapshots
### 
### Bis zu Version VERSION[1.2.8] wird WATO immer dann, wenn Sie
### Änderungen aktivieren, automatisch eine Sicherung der Konfiguration
### erstellen. Die Liste dieser Sicherungen erreichen Sie über das WATO-Modul
### ICON[icon_backup.png] [.guihints]#Backup & Restore}}:# 
### 
### BI:wato_snapshots.png
### 
### Ein Klick auf die ICON[icon_edit.png] Details eines Snaphots und dann auf
### [.guihints]#Restore Snapshot# spielt diesen Konfigurationsstand wieder ein. *Wichtig*:
### Es wird nur die Konfiguration zurückgespielt. Der Zustand und die Historie des
### Monitorings werden davon nicht beeinflusst.
### 
### *Dieses Feature steht Ihnen ab Version VERSION[1.4.0* nicht mehr zur Verfügung, da es komplett überarbeitet wird.]
### 

== Backups
=== Grundlagen

Im Laufe der Zeit werden Sie einiges an Arbeit in die genaue
Konfiguration Ihrer Hosts und Services, Grenzwerte, Alarmierungen
und so weiter stecken -- daher sollten Sie Backups erstellen.
Das ist nicht nur nützlich für den Fall, dass etwas schiefgeht,
sondern auch zum Testen oder Nutzen unterschiedlicher
Konfigurationen. Sie können die komplette Konfiguration über das
WATO-Modul [.guihints]#Backups# sichern und bei Bedarf auch wieder
zurückspielen. Backups lassen sich zeitgesteuert ausführen, verschlüsseln und komprimieren.

=== Verschlüsselte, komprimierte Backups konfigurieren
Im ersten Schritt legen Sie über [.guihints]#WATO => Backups => Backup targets => Newbackup target}}# 
ein neues Backupziel an. Die absolute Pfadangabe bezieht sich auf das System, nicht auf die Instanz.

image::bilder/backup_target_config.png[]

Erstellen Sie anschließend einen neuen Schlüssel für Ihre Backups
über ICON[icon_backup_keys.png] mit einem aussagekräftigen Namen
und einem sicheren Passwort.

image::bilder/backup_key_config.png[]

*Achtung:* Nach dem Erstellen des Schlüssels werden Sie eine
Warnmeldung sehen, die Sie darauf hinweist, dass Sie die Schlüssel
noch nicht heruntergeladen haben. Da Sie diese Schlüssel für die
Wiederherstellung von Backups zwingend benötigen, verbleibt die
Meldung bis alle Schlüssel gesichert wurden.

image::bilder/backup_key_warning.png[]

Nun können Sie über ICON[icon_backup_newjob.png] einen neuen Sicherungsauftrag erstellen und unter anderem die eben erstellten Elemente unter [.guihints]#Target# beziehungsweise [.guihints]#Encryption# wählen. Zudem finden Sie hier Optionen für die Komprimierung und die zeitliche Backupplanung. Wie Sie gleich sehen werden, können Sie Backups aber auch manuell anstoßen. Über [.guihints]#Do not backup historical data# lassen sich Metriken (RRD-Dateien), Monitoringverlauf und Logdateien einsparen, was zu deutlich kleineren Backuparchiven führt.

image::bilder/backup_job_config.png[]

=== Backups erstellen

Wieder zurück auf der Startseite des Backupmoduls sehen Sie nun Ihren fertigen Backupauftrag und können ihn über ICON[icon_backup_start.png] starten:

image::bilder/backup_job_play.png[align=border]

Laufende Backups können Sie über ICON[icon_backup_stop.png] stoppen:

image::bilder/backup_job_running.png[align=border]

Zu guter Letzt sehen Sie die Bestätigung des fertiggestellten Backups:

image::bilder/backup_job_finished.png[align=border]

Sowohl bei laufenden als auch bei abgeschlossenen Aufträgen gelangen Sie über ICON[icon_backup_state.png] zu einer ausführlichen Statusmeldung.

=== Backups zurückspielen
Die Wiederherstellung von Backups starten Sie über ICON[icon_backup_restore.png], das Vorgehen ist weitestgehend selbsterklärend:

. Wählen Sie den Backupauftrag.
. Wählen Sie die gewünschte Backupdatei.
. Starten und autorisieren Sie den Vorgang mit dem Backupschlüssel.

Nach der Wiederherstellung wird die Instanz neu gestartet, daher sehen Sie kurzzeitig eine 503-Fehlermeldung:

image::bilder/backup_restore_warning.png[]

Sobald die Instanz wieder ferfügbar ist bekommen Sie eine ausführliche Statusmeldung über das erfolgreiche Backup:

image::bilder/backup_restore_finished.png[align=border]

== Wichtige WATO-Module

WATO besitzt zahlreiche Module -- eines für jeden wichtigen Aspekt von Checkmk.
Folgende Module sind besonders wichtig:

[cols=, options="header"]
|===


<th width="5%"></th>
|Modul|Aufgabe


|ICON[icon_home.png]
|{{Main Menu}}
|Auflistung aller WATO-Module mit kurzer Erklärung.


|ICON[icon_agents.png]|{{Monitoring Agents}}
|Hier finden Sie (CMK)-Agenten für Linux, Windows und andere Betriebsysteme.
In den (EE) können Sie die Agenten auch über WATO konfigurieren, paketieren und
automatisch updaten.


|ICON[icon_folder.png]
|{{Hosts}}
|Verwaltung der zu überwachenden Hosts -- das wohl wichtigste Modul.


|ICON[icon_configuration.png]
|{{Global Settings}}
|Globale Einstellungen -- also solche, die nicht bestimmte Hosts, Services oder
Benutzer betreffen.


|ICON[icon_rulesets.png]
|{{Host & Service Parameters}}
|Alle Einstellungen für bestimmte Hosts oder Services finden Sie hier. Die
Konfiguration geschieht [wato_rules|regelbasiert.]

|===


== Quickaccess

Wenn Sie schon länger mit WATO arbeiten, werden Sie die Symbole im Menü auswendig
kennen. Dann empfiehlt sich die kleinere Variante des WATO-Menüs für die Seitenleiste:

image::bilder/wato_quickaccess.png[align=center,width=42%]
