include::global_attr.adoc[]
= Lizenzen verwalten
:revdate: draft
:title: Lizenzen verwalten - Lizenzinformationen sammeln und übermitteln
:description: Hiermit sammeln Sie transparente Information über den aktuellen Lizenzstatus und versenden diese bei gleichzeitiger voller Kontrolle über die Datenübermittlung.

==  Einleitung

{cee-only} Nutzen Sie {CSE} oder {CME}, so führen Sie mindestens einmal pro Jahr einen Lizenzaudit durch, d.h. Sie erstellen eine Übersicht über die von Ihrem Unternehmen genutzten Lizenzen und geben diese an tribe29 oder den Sie betreuenden Partner von tribe29 weiter.
Diese Verwaltungsarbeit kann {CMK} Ihnen zwar nicht ganz abnehmen, aber dennoch erheblich erleichtern.

{CMK} sammelt jeden Tag zu einem zufälligen Zeitpunkt die aktuellen Service-Zahlen für alle verbundenen Instanzen. Diese werden dann in der Lizenzverwaltung übersichtlich und transparent dargestellt.

{CMK} speichert diese Informationen fortlaufend über einen Zeitraum von 400 Tagen, übermittelt diese aber niemals selbsttätig. Ältere Daten werden entfernt.

Als Administrator von {CMK} können Sie die Lizenzinformationen dann aktiv herunterladen und danach manuell in das Kundenportal von tribe29 hochladen. Alternativ können Sie diese ganz bequem direkt von {CMK} an das Kundenportal von tribe29 übermitteln lassen. In jedem Fall behalten Sie durchgängig die volle Kontrolle über die Datenweitergabe und die übermittelten Inhalte.

==  Nutzung der Lizenzverwaltung

[#einrichtung]
=== Eingabe der Subskriptionsdaten

Öffnen Sie als {CMK}-Benutzer mit xref:wato_user#[Administrator-Rechten] [guihint]#Setup > Maintenance > License usage#. Die Seite ist noch leer, so lange keine Subskiptionsdaten hinterlegt wurden.

image::license_license_usage_ausschnitt.png[alt="Auswahl Edit subscription settings"]

Öffnen Sie mit dem Knopf [guihint]#Edit subscription settings# die gleichnamige Seite:

image::license_edit_subscription.png[alt="Formular zur Eingabe der Subskriptionseinstellungen."]

Tragen Sie nun Beginn und Ende Ihres aktuellen Abonnementzeitraums in die entsprechenden Felder im Abschnitt [guihint]#Subscription details# ein. Darunter wählen Sie eine der vorgegebenen Abonnementgrößen aus. Alternativ können Sie mit der Auswahl [guihint]#Custom limit# einen eigenen Wert eingeben, wenn der für Ihre Umgebung zutreffende Wert nicht angeboten wird.

Wollen Sie die Direktübermittlung der Lizenzinformationen nutzen, so füllen Sie ergänzend den zweiten Abschnitt [guihint]#Customer portal credentials# mit Ihrem Benutzernamen sowie Passwort für das link:https://customer.checkmk.com/[{CMK}-Kundenportal^].


=== Angezeigte Lizenzinformationen

{CMK} beginnt dann, die lizenzrelevanten Informationen aufzuzeichnen und in Form eines farbigen Diagramms anzuzeigen.

image::license_usage.png[alt="Übersicht über die aktuelle Lizenznutzung."]

Anhand der verschiedenfarbigen Elemente können Sie Folgendes ablesen:

* Die rote Linie zeigt das aktuell in den [guihint]#xref:einrichtung[Subscription details]# eingetragene Lizenzlimit. Damit sind Überschreitungen der Services-Anzahl leicht zu erkennen.
* Die hellblaue Linie zeigt die durchschnittliche Servicezahl pro Monat an. Hierdurch werden Spitzen, die z.B. durch eine Fehlkonfiguration entstehen, geglättet.
* Die dunkelblaue Linie zeigt für jeden Tag die Gesamtzahl der
überwachten Services über alle verbundenen Instanzen hinweg an.
* Die grüne Spalte zeigt die durchschnittliche Anzahl an Services im aktuellen Monat.
* Die gelbe Spalte zeigt den ersten Monat, in dem die bezahlte Subskriptionsgröße überschritten wird.
* Die lila Spalte zeigt den Monat mit der höchsten Lizenzüberschreitung.

In der Tabelle unterhalb der Grafik sind die Instanzen der aktuellsten Lizenzerhebung einzeln aufgelistet.


== Übermittlung der Lizenzinformationen an tribe29
Als Benutzer von {CSE} oder {CME} können Sie Ihre Lizenzinformationen (die Angaben, die Sie auf den Seiten [guihint]#License usage# und [guihint]#Edit subscription settings# sehen sowie einen auf der Seite [guihint]#Submit or download license usage report# ergänzten Kommentar) entweder manuell übermitteln oder Sie lassen {CMK} den Großteil der Arbeit übernehmen.

=== Manuelle Übermittlung
Ihre Lizenzinformationen sind für Sie jederzeit transparent einsehbar und sie können diese ganz einfach herunterladen und manuell in das tribe29-link:https://customer.checkmk.com/[Kundenportal] hochladen.

Öffnen Sie dazu [guihint]#Setup > Maintenance > License usage#. Klicken Sie dann auf den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit or download.#

image::license_license_usage_ausschnitt2.png[alt="Auswahl Submit or download."]

Sie gelangen auf die Seite [guihint]#Submit or download license usage report#.

image::license_submit_or_download.png[alt="Seite für Übertragung und Download der Lizenzinformationen."]

Mit dem Knopf icon:icon_download[alt="Grüner Kreis mit Haken."] [guihint]#Download report# starten Sie, nach der Festlegung des gewünschten Pfades, den Download des gz-Archivs (Tar-Archiv). Darin enthalten ist eine json-Datei, bestehend aus der Version (VERSION), einer Liste (history) und den Details zu der Subskription als Dictionary. Letzteres enthält die Informationen zu den einzelnen Datenpunkten.

Verlassen Sie nun {CMK} und wechseln Sie zum link:https://customer.checkmk.com/[tribe29-Kundenportal]. Loggen Sie sich dort mit Ihren Zugangsdaten ein, um die Lizenzinformationen hoch zu laden. Wählen Sie dazu [guihint]#License Audit# im Menü der linken Seitenleiste.

image::license_license_audit.png[width=35% alt="Linkes Seitenmenü im Kundenportal."]

Es öffnet sich das Fenster [guihint]#License Audit Upload#, in das Sie die Datei mit den Lizenzinformationen über Drag & Drop (Ziehen & Fallenlassen) in das graue Feld hochladen. Alternativ klicken Sie in dieses Feld, um ein Browser-Fenster für die Auswahl der Datei zu öffnen.

image::license_audit_upload_customer.png[alt="Seite zur Übermittlung der Lizenzinformationen."]

Geben Sie Ihr Passwort ein und starten Sie die Übertragung der Datei mit einem Klick auf den Knopf [guihint]#Upload license audit#. Das erfolgreiche Hochladen wird abschließend bestätigt.

[#direktübermittlung]
=== Direktübermittlung durch {CMK}
Um sich die Arbeit noch weiter zu vereinfachen, können Sie die Übermittlung der Lizenzinformationen vordefinieren. Sie ist dann mit wenigen Klicks direkt aus {CMK} heraus durchführbar.

*Hinweis:* Ihre Zugangsdaten für das link:https://customer.checkmk.com/[Kundenportal] müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:einrichtung[Einrichtung der Lizenzverwaltung]).

Nutzen Sie auf der Seite [guihint]#Submit or download license usage report# den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit report.# Ihre Lizenzinformationen werden dann direkt in Ihren Bereich des tribe29-Kundenportals übertragen und Sie erhalten eine entsprechende Bestätigung.

image::license_submit_license_success.png[alt="Bestätigung der erfolgreichen Lizenzdaten-Übermittlung"]

=== Ergänzende Informationen für tribe29-Partner
Als Partner von tribe29 können Sie nicht nur Ihre eigenen Lizenzinformationen einfach und schnell an tribe29 melden, sondern ebenso einfach auch die Lizenzinformationen Ihrer Kunden entweder manuell aus {CMK} herunterladen und dann in das Partnerportal von tribe29 hochladen. Oder Sie lassen {CMK} auch hierbei den Großteil der Arbeit erledigen.
Die xref:direktübermittlung[Direktübermittlung durch {CMK}] der kundenbezogenen Informationen entspricht exakt dem oben beschriebenen Vorgehen. Lediglich bei der manuellen Übermittlung gibt es kleine Unterschiede.

Wenn Sie einen direkten Zugang zu {CMK} bei Ihrem Kunden haben, erstellen Sie den Lizenzbericht analog zu dem oben für alle Benutzer beschriebenen Vorgehen.

Haben Sie keinen direkten Zugang zu {CMK} bei Ihrem Kunden, so bitten Sie diesen, den Download für Sie durchzuführen und lassen Sie sich die Datei zuschicken.

Loggen Sie sich danach mit Ihren Zugangsdaten in das tribe29-link:https://customer.checkmk.com/[Kundenportal] ein (tribe29-Partnern stehen hier zusätzliche Optionen zur Verfügung). Wählen Sie [guihint]#Resold Licenses# im Menü der linken Seitenleiste.

image::license_resold_licenses.png[width=35% alt="Linkes Seitenmenü im Partnerportal."]

Es öffnet sich das Fenster [guihint]#Resold Licenses#.

image::license_resold_licenses_rechts.png[alt="Ansicht aller zugehörigen Endkundenlizenzen im Partnerportal."]

Klicken Sie in der Zeile des betreffenden {CMK}-Benutzers auf den Knopf icon:button_upload_audit[alt="Wolke mit Pfeil."]. Analog zum Vorgehen für alle Benutzer laden Sie die Datei mit den Lizenzinformationen entweder über Drag & Drop (Ziehen & Fallenlassen) in das graue Feld hoch oder klicken Sie in dieses Feld, um einen Browser für die Auswahl der Datei zu öffnen.

image::license_audit_upload.png[alt="Ansicht aller zugehörigen Endkundenlizenzen im Partnerportal."]

Starten Sie das Hochladen der Datei mit einem Klick auf den Knopf [guihint]#Upload license audit#. Das erfolgreiche Hochladen wird abschließend bestätigt.
