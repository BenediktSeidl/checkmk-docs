include::global_attr.adoc[]
= Lizenzen verwalten
:revdate: draft
:title: Lizenzen verwalten - Lizenzinformationen sammeln und übermitteln
:description: Hiermit sammeln Sie transparente Information über den aktuellen Lizenzstatus und versenden diese bei gleichzeitiger voller Kontrolle über die Datenübermittlung.

==  Einleitung

{cee-only} Nutzen Sie {CSE} oder {CME}, so führen Sie mindestens einmal pro Jahr einen Lizenzaudit durch, d.h. Sie erstellen eine Übersicht über die von Ihrem Unternehmen genutzten Lizenzen und geben diese an tribe29 oder den Sie betreuenden Partner von tribe29 weiter.
Diese Verwaltungsarbeit kann {CMK} Ihnen zwar nicht ganz abnehmen, aber dennoch erheblich erleichtern.

{CMK} sammelt jeden Tag zu einem zufälligen Zeitpunkt die aktuellen Service-Zahlen für alle verbundenen Instanzen. Diese werden dann in der Lizenzverwaltung übersichtlich dargestellt.

{CMK} speichert diese Informationen fortlaufend über einen Zeitraum von 400 Tagen, übermittelt diese aber niemals selbsttätig. Ältere Daten werden entfernt.

Als Administrator von {CMK} können Sie die Lizenzinformationen dann aktiv herunterladen und danach manuell in das Kundenportal von tribe29 hochladen. Alternativ können Sie diese ganz bequem direkt von {CMK} an das Kundenportal von tribe29 übermitteln lassen. In jedem Fall behalten Sie durchgängig die volle Kontrolle über die Datenweitergabe.

==  Nutzung der Lizenzverwaltung

[#einrichtung]
=== Eingabe der Subskriptionsdaten

////
MA:
Was ist ein Checkmk-Administrator?
Hier geht es wohl um einen Nutzer, welcher der Admin-Rolle zugewiesen ist,
oder einer Rolle, welche die Berechtigungen hat, den Menüpunkt einzusehen/zu bearbeiten.
Da bietet sich dann auch ein Verweis auf den Artikel an,
wo die Rollen in Checkmk beschrieben werden.
////

Öffnen Sie als {CMK}-Administrator [guihint]#Setup > Maintenance > License usage#. Die Seite ist noch leer, so lange keine Subskiptionsdaten hinterlegt wurden.

////
MA:
Hier hätte ich anhand des Textes erwartet, dass ein Screenshot der Seite kommt,
wo ich den Button/Knopf finde.
////
Öffnen Sie mit dem Knopf [guihint]#Edit subscription settings# die gleichnamige Seite:

// MA: Schrift im Sreenshot definitiv zu klein. Relevanter Text ist ja "Source" oder "Period start date".
image::license_edit_subscription.png[alt="Formular zur Eingabe der Subskriptionseinstellungen."]

Tragen Sie nun Beginn und Ende Ihres aktuellen Abonnementzeitraums in die entsprechenden Felder im Abschnitt [guihint]#Subscription details# ein. Darunter wählen Sie eine der vorgegebenen Abonnementgrößen aus. Alternativ können Sie mit der Auswahl [guihint]#Custom limit# einen eigenen Wert eingeben, wenn der für Ihre Umgebung zutreffende Wert nicht angeboten wird.

Wollen Sie die Direktübermittlung der Lizenzinformationen nutzen, so füllen Sie ergänzend den zweiten Abschnitt [guihint]#Customer portal credentials# mit Ihrem Benutzernamen sowie Passwort für das link:https://customer.checkmk.com/[{CMK}-Kundenportal^].


=== Angezeigte Lizenzinformationen

Die erfassten Lizenzinformationen werden in Form eines farbigen Diagramms angezeigt.

// MA: Auch hier ist die Schrift zu klein. Mit ein paar Tricks bekommt man die vielleicht noch größer
image::license_usage.png[alt="Übersicht über die aktuelle Lizenznutzung."]

Anhand der verschiedenfarbigen Elemente können Sie Folgendes ablesen:

////
MA:
Ich verstehe die Intention hinter der Liste. Aber im Endeffekt steht das ja auch schon im Screenshot.
Vielleicht kann man das noch mit Rahmeninformationen anreichern, die helfen,
die Hintergründe der einzelnen Daten zu verstehen?
////
* Die rote Linie zeigt das aktuell in den [guihint]#xref:einrichtung[Subscription details]# eingetragene Lizenzlimit. Damit sind Überschreitungen der Services-Anzahl leicht zu erkennen.
* Die hellblaue Linie zeigt die durchschnittliche Servicezahl pro Monat an. Hierdurch werden Spitzen, die z.B. durch eine Fehlkonfiguration entstehen, geglättet.
* Die dunkelblaue Linie zeigt für jeden Tag die Gesamtzahl der
überwachten Services über alle verbundenen Instanzen hinweg an.
* Die grüne Spalte zeigt die durchschnittliche Anzahl an Services in einem Monat.
// MA: Das ist nicht ganz korrekt. Es zeigt die Anzahl in _diesem_ Monat an.
* Die gelbe Spalte zeigt den ersten Monat, in dem die bezahlte Subskriptionsgröße überschritten wird.
* Die lila Spalte zeigt den Monat mit der höchsten Lizenzüberschreitung.

// MA: Falls es den Screenshot einfacher macht (mir sind da ein paar Dinge aufgefallen), würde ich diesen Teil in einen eigenen Screenshot packen.
In der Tabelle unterhalb der Grafik sind die Instanzen der aktuellsten Lizenzerhebung einzeln aufgelistet.


=== Übermittlung der Lizenzinformationen als tribe29-Kunde
// MA: "Als {EE}-Benutzer laden Sie Ihre Lizenzinformation..." - Ich würde im Handbuch eigentlich ungern von Kunden sprechen. Das Handbuch ist für die Nutzer der Software. Und "können" wollen wir vermeiden. ;)
Als tribe29-Kunde können Sie Ihre Lizenzinformationen (die Angaben, die Sie auf den Seiten [guihint]#License usage# und [guihint]#Edit subscription settings# sehen sowie einen auf der Seite [guihint]#Submit or download license usage report# ergänzten Kommentar) entweder manuell herunterladen und dann in das Kundenportal von tribe29 hochladen oder Sie lassen {CMK} den Großteil der Arbeit übernehmen.

==== Manuelle Übermittlung
Wie in der Einleitung erwähnt, können Sie die Lizenzinformationen jederzeit herunterladen und manuell in das tribe29-link:https://customer.checkmk.com/[Kundenportal] hochladen.
// MA: Können? Was passiert denn, wenn ich es nicht mache? Warum sollte ich es überhaupt machen?

Nutzen Sie auf der Seite [guihint]#License usage# den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit or download.# Sie gelangen auf die Seite [guihint]#Submit or download license usage report#.
// MA: Finde ich noch etwas hölzern formuliert.

// MA: Syntax der Metainformationen ist kaputt, weil das Komma hier Parameter trennt. Warum sollte die Breite 0,755 sein? Umgesetzt wurde 755. Hier ein paar Beispiele, wie es korrekt wäre:
// image::license_submit_or_download.png[width=755 alt="Seite für Übertragung und Download der Lizenzinformationen."]
// image::license_submit_or_download.png[alt="Seite für Übertragung und Download der Lizenzinformationen."]
image::license_submit_or_download.png[width=0,755 alt="Seite für Übertragung und Download der Lizenzinformationen."]

Mit dem Knopf icon:icon_download[alt="Grüner Kreis mit Haken."] [guihint]#Download report# starten Sie, nach der Festlegung des gewünschten Pfades, den Download des gz-Archivs (Tar-Archiv). Darin enthalten ist eine json-Datei, die Komma-separiert die wesentlichen Lizenz-Informationen enthält.
// MA: Der Hinweis auf die Komma-separierten Lizenz-Information suggeriert eine csv-Datenstruktur. Tatsächlich ist hier aber eine echte json-Datenstruktur vorhanden, in der sich die Version (VERSION), eine Liste (history) und die Details zu der Subskription als Dictionary befindet. Letztere enthält dann die Dictionaries mit den Informationen zu den einzelnen Datenpunkten. Wichtig scheint mir hier zu sein, dass wir transparent (=man kann sich die übermittelten Daten im Klartext anschauen) und nicht heimlich noch Metadaten mit schicken. Alle Daten kann man einsehen und es macht den Prozess für alle einfacher.

Diese laden Sie dann in das tribe29-Kundenportal hoch. Loggen Sie sich dazu mit Ihren Zugangsdaten in das tribe29-Kundenportal ein. Wählen Sie [guihint]#License Audit# im Menü der linken Seitenleiste.
// MA: Bisher befanden wir uns noch in der GUI von Checkmk und im nächsten Absatz auf der Webseite. Da sollten ir im Zweifel besser anleiten, dass wir gerade eine Oberfläche verlassen und in eine andere einsteigen. Wo finde ich die? Oben gab es einen Link (und weiter unten auch noch einmal), aber hier nicht mehr, ob ich hier konkret auf dem Kundenportal etwas tun muss.

// MA: In Zusammenhang mit der fehlenden Führung, wo wir jetzt genau hin mussten, fehlt zu dem Screenshot etwas der Kontext. Ich weiß nun nicht genau, wo ich den suchen soll.
image::license_license_audit.png[width=35% alt="Linkes Seitenmenü im Kundenportal."]

Es öffnet sich das Fenster [guihint]#License Audit Upload# in das Sie die Datei mit den Lizenzinformationen entweder über Drag & Drop (Ziehen & Fallenlassen) in das graue Feld hochladen. Alternativ klicken Sie in dieses Feld, um ein Browser-Fenster für die Auswahl der Datei zu öffnen.

image::license_audit_upload_customer.png[width=80% alt="Seite zur Übermittlung der Lizenzinformationen."]

Geben Sie Ihr Passwort ein und starten Sie das Hochladen der Datei mit einem Klick auf den Knopf [guihint]#Upload license audit#. Das erfolgreiche Hochladen wird abschließend bestätigt.

==== Direktübermittlung durch {CMK}
Um sich die Arbeit noch weiter zu vereinfachen, können Sie die Übermittlung der Lizenzinformationen vordefinieren. Sie ist dann mit wenigen Klicks durchführbar.

*Hinweis:* Ihre Zugangsdaten für das link:https://customer.checkmk.com/[Kundenportal] müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:einrichtung[Einrichtung der Lizenzverwaltung]).

Nutzen Sie auf der Seite [guihint]#Submit or download license usage report# den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit report.# Ihre Lizenzinformationen werden dann direkt in Ihren Bereich des tribe29-Kundenportals übertragen und Sie erhalten eine entsprechende Bestätigung.

// MA: Hier ist die Schrift wieder viel zu klein.
image::license_submit_license_success.png[width=85% alt="Bestätigung der erfolgreichen Lizenzdaten-Übermittlung"]

=== Übermittlung der Lizenzinformationen als tribe29-Partner
////
MA:
In dem gesamten Abschnitt stellt sich mir die Frage, ob und was hier anders ist.
Vor allem im Vergleich zu dem Abschnitt vorher.
Als Leser ist mir das einiges unklar und nicht direkt ersichtlich:
Ich habe nun gelernt, was ich als Kunde machen muss
(wann bin ich tribe29-Kunde? Bin ich nicht immer tribe29-Kunde, wenn ich Checkmk lizensiert einsetze?),
um meine Subskriptionsnutzung zu melden.
Aber was ändert sich für mich, wenn ich Partner bin, oder von einem Partner vermittelt wurde?
Was ändert sich, wenn ich Nutzer einer bestimmten Edition bin
und Checkmk für unterschiedliche Firmen betreue
(z.B. weil ich eine Konzernlizenz habe, eine CME, ein Partner bin, der ebenfalls eine Lizenz einsetzt, usw.).
An wen richtet sich das Kapitel und welche Fragen werden die betroffenen Personen haben?
////

Auch als Partner von tribe29 können Sie die Lizenzinformationen Ihrer Kunden entweder manuell aus {CMK} herunterladen und dann in das Partnerportal von tribe29 hochladen. Oder Sie lassen {CMK} den Großteil der Arbeit erledigen.

==== Manuelle Übermittlung
Wie oben erwähnt, können Sie die Lizenzinformationen herunterladen und manuell in das tribe29-Partnerportal hochladen.

// MA: Der nachfolgende Absatz ist redundant zu dem oben, oder? Ist es dann nicht sinnvoller, auf den Abschnitt oben zu verweisen, sofern man direkten Zugang zu dem Checkmk des Kunden hat?
Wenn Sie einen direkten Zugang zu {CMK} bei Ihrem Kunden haben, dann nutzen Sie auf der Seite [guihint]#License usage# den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit or download.# Sie gelangen auf die Seite [guihint]#Submit or download license usage report#.

image::license_submit_or_download.png[width=85% alt="Seite für Übertragung und Download der Lizenzinformationen."]

Mit dem Knopf icon:icon_download[alt="Grüner Kreis mit Haken."] [guihint]#Download report# starten Sie, nach der Festlegung des gewünschten Pfades, den Download des gz-Archivs (Tar-Archiv). Darin enthalten ist eine json-Datei, die Komma-separiert die wesentlichen Lizenz-Informationen enthält.

Haben Sie keinen direkten Zugang zu {CMK} bei Ihrem Kunden, so bitten Sie diesen, den Download für Sie durchzuführen und lassen Sie sich die Datei zuschicken.

// MA: Der nachfolgende Link ist identisch zu dem Kundenportal. Hier ist wichtig, dass das kein Tippfehler ist, sondern die Adresse zwar identisch ist, aber man als Partner mehr Optionen zur Verfügung hat.
Loggen Sie sich danach mit Ihren Zugangsdaten in das tribe29-link:https://customer.checkmk.com/[Partnerportal] ein. Wählen Sie [guihint]#Resold Licenses# im Menü der linken Seitenleiste.

image::license_resold_licenses.png[width=35% alt="Linkes Seitenmenü im Partnerportal."]

Es öffnet sich das Fenster [guihint]#Resold Licenses#.

// MA: Hier lohnt sich imho ein Rahmen um das Bild, da der Kontrast zwischen Bildhintergrund und docs sehr gering ist. Vorsicht: Funktioniert nicht sehr gut mit Bildern, die nicht die volle Breite nutzen!
[{image-border}]
image::license_resold_licenses_rechts.png[alt="Ansicht aller zugehörigen Endkundenlizenzen im Partnerportal."]

// MA: Auch hier bietet es sich an, auf den Abschnitt weiter oben zu verweisen. Also abgesehen von dem unterschiedlichen Upload-Button.
Klicken Sie in der Zeile des betreffenden Endkunden auf den Knopf icon:button_upload_audit[alt="Wolke mit Pfeil."]. Nun laden Sie die Datei mit den Lizenzinformationen entweder über Drag & Drop (Ziehen & Fallenlassen) in das graue Feld hoch oder klicken Sie in dieses Feld, um einen Browser für die Auswahl der Datei zu öffnen.

image::license_audit_upload.png[width=85% alt="Ansicht aller zugehörigen Endkundenlizenzen im Partnerportal."]

Starten Sie das Hochladen der Datei mit einem Klick auf den Knopf [guihint]#Upload license audit#. Das erfolgreiche Hochladen wird abschließend bestätigt.

==== Direktübermittlung durch {CMK}
// MA: Redundant zu oben. Gibt es einen Unterschied für Kunden, die über einen Partner vermittelt wurden, oder funktioniert es identisch? Das ist wahrscheinlich eher die Frage, die sich ein Partner (oder ein vermittelter Kunde) stellt. Den Absatz am Anfang des Abschnitts hab ich erst später geschrieben.
Um sich die Arbeit noch weiter zu vereinfachen, können Sie die Übermittlung der Lizenzinformationen vordefinieren. Sie ist dann mit wenigen Klicks durchführbar.

*Hinweis:* Die Zugangsdaten Ihres Kunden für das link:https://customer.checkmk.com/[Kundenportal] müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:einrichtung[Einrichtung der Lizenzverwaltung]).

Nutzen Sie auf der Seite [guihint]#Submit or download license usage report# den Knopf icon:icon_assume_0[alt="Grüner Kreis mit Haken."] [guihint]#Submit report.# Die Lizenzinformationen werden dann direkt in Ihren Kundenbereich des tribe29-Partnerportals übertragen und Sie erhalten eine entsprechende Bestätigung.

image::license_submit_license_success.png[width=85% alt="Bestätigung der erfolgreichen Lizenzdaten-Übermittlung"]


////
MA / allgemein:
Generell wollen wir ja nicht nur eine Dokumentation sein, sondern ein Handbuch.
Wir vermitteln also nicht nur, wie etwas funktioniert,
was ich danach an Resultat erwarten kann und was ich tun kann, wenn ich Probleme habe.
Sondern auch, warum ich das überhaupt tun sollte, warum das Resultat so ist, wie es ist.
Ich möchte den Leser befähigen, die Hintergründe zu verstehen,
damit er/sie in der Lage ist, das Gelernte auch auf neue,
unvorhergesehene Problem/Anwendungsfälle anzuwenden.
Dafür ist es zwingend notwendig, nicht nur zu erklären, was zu tun ist,
sondern auch _warum_ es zu tun ist.

Beispiel: Ein Leser lernt, dass er die Schritte A, B, C und D zu gehen hat, damit er 123 bekommt.
Solange er nicht versteht, warum er (der Leser und auch die Lesering) diese Schritte ausführt,
wird er verloren sein, sollte sich an den Schritten etwas kleines ändern.
Oder anders: Wir wollen die Leser nicht konditionieren, sondern zu etwas befähigen.

Mir selbst fällt das immer wieder auf, wenn ich im Internet Dokumentationen/Anleitungen lese.
Ich möchte einen Mailserver einrichten, also mache ich xyz.
Aber welche Schritte davon brauche ich, wenn ich gar keine Datenbank für die Mailpostfächer benutzen will,
sondern die Systembenutzer?
Ab dem Punkt sind die meisten Anleitungen/Dokumentationen nutzlos, weil sie so geschrieben sind,
dass ich von dem beschriebenen Pfad gar nicht abweichen kann.
Ich mache xyz und weiß gar nicht, weshalb.
Checkmk soll aber keine Blackbox sein. :)
////