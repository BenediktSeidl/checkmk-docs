= Alarmierung per PagerDuty (Notifications)
:revdate: draft
[.seealso][#notifications]:title: Alarmierung per PagerDuty
###MD:Die PagerDuty-Integration von Checkmk ermöglicht die Alarmierung Issues aus der Monitoring-Lösung heraus.

== Funktion
Die Incident-Managment-Plattform <a
href="https://www.pagerduty.com">PagerDuty</a> kann aus unterschiedlichsten
Quellen Meldungen empfangen und diese weiterverarbeiten, also zum Beispiel
filtern, als Alarmierungen versenden oder Eskalationen in Gang setzen. Aus Checkmk
lassen sich Benachrichtigungen ganz einfach über einen Schlüssel an die
Plattform leiten.

== Konfiguration PagerDuty
PagerDuty bietet Integrationen für viele populäre Werkzeuge, darunter auch Checkmk.
Dazu benötigen Sie lediglich einen _Integration Key,_ den Sie unter PagerDuty
wie folgt anlegen:

. Erstellen Sie einen neuen Service oder öffnen Sie einen vorhandenen.
. Im entsprechenden Service erstellen Sie über den Reiter [.guihints]#Integrations# eine neue Integration.
. Vergeben Sie einen beliebigen Namen und wählen Sie als [.guihints]#Integration Type# den Punkt [.guihints]#Check_MK.}}# 
. Kopieren Sie den erzeugten [.guihints]#Integration Key.}}# 

== Konfiguration Checkmk
In Checkmk beschränkt sich die Einbindung auf die Angabe des Integrationsschlüssels:

. Wählen Sie als [.guihints]#Notification Method# den Punkt [.guihints]#PagerDuty.}}# 
. Tragen Sie unter [.guihints]#Integration Key# den kopierten Schlüssel ein.

image::bilder/notifications_pagerduty.png[]

COMMENT[SK: Ich glaube, dass das so nicht funktioniert. Wenn kein Benutzer angegeben wird, werden angeblich (sagte Marsellus mal) auch keine Alarmierungen ausgelöst. Vielleicht sollten wir hier den Weg über Users -> Glocke vor ID beschreiben. Auf der Webseite von Partydroge.com legen die einen dedizierten Nutzer für PagerDuty an.]

Die Filterung der erzeugten Benachrichtigungen können Sie wahlweise in Checkmk
oder erst in PagerDuty über die [.guihints]#Event Rules# umsetzen. Optional können Sie
die PagerDuty-Anbindung auch auf ein eigenes Checkmk-Nutzerkonto aufschalten.
Erstellen Sie dazu einfach einen Standard-Nutzer mit deaktiviertem Login und
anschließend eine persönliche Alarmierungsregel.

COMMENT[SK: Das folgende ist mir zu negativ. Die Beschreibung, wie man das mit Fake Check Result testen kann genügt hier völlig.]

Sie können die Anbindung wieder über [commands|Kommandos] testen, allerdings
funktioniert das auch hier nicht über das Kommando [.guihints]#Custom notification.}}# 
Nutzen Sie stattdessen abermals das Kommando [.guihints]#Fake check results# und setzen
Sie einen von der Regel erfassten Host darüber auf (DOWN).
