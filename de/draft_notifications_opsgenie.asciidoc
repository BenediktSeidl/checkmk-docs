= Alarmierung per Opsgenie (Notifications)
:revdate: draft
[.seealso][#notifications]:title: Alarmierung per Opsgenie
###MD:

== Funktion
<a href="https://www.atlassian.com/software/opsgenie">Opsgenie,</a> mittlerweile
Teil von Atlassian, bietet als Incident-Management-Plattform Alarmierungen und
Eskalationen für Teams und kann dabei viele externe Tools integrieren, darunter
auch Checkmk. Die grundsätzliche Anbindung benötigt lediglich einen API-Schlüssel
und eine URL, Sie können in Checkmk jedoch auch weitere Optionen festlegen,
beispielsweise zusätzliche Informationen je nach Art der Quelle des Alarms.

== Konfiguration Opsgenie
Zur Integration von Checkmk finden Sie direkt innerhalb von Opsgenie eine kurze
Anleitung -- die sich jedoch auf eine ältere Checkmk-Version bezieht, in der Sie
noch eine komplette URL samt API-Schlüssel übergeben mussten. In aktuellen
Versionen geben Sie URL und Schlüssel separat ein. Zudem ist die URL nur für in
Europa gehostete Accounts nötig.

COMMENT[ML: In der Online-Hilfe wird eine URL in der Form my.app.eu.opsgenie.com genannt, korrekt ist aber api.eu.opsgenie.com. Da es die URL in der ersten Form ebenfalls gibt, sollte sie so aus der Hilfe verschwinden - oder die Hilfe ergänzt werden, sofern die URL in irgendeiner anderen Konfiguration in der my.app-Variante funktioniert. Und da zudem die Anleitung innerhalb von Opsgenie ebenfalls falsch ist, ist es derzeit ein wenig verwirrend ...]

COMMENT[SK: Der Herr Entwickler (RB) hat sich hier nach eigener Angabe ver-copy-pastet. https://api.bla.blub ist richtig. Die Änderung in der Inline-Help ist schon unterwegs.]

. Legen Sie ein Team an oder rufen Sie ein bestehendes auf.
. Wählen Sie unter [.guihints]#Integrations/Add Integration# den Eintrag Checkmk.
. In der nun angezeigten, fehlerhaften Anleitung finden Sie unter dem Punkt [.guihints]#Paste# eine URL samt Optionen und API-Key -- kopieren Sie den Domain-Teil der URL (https://api.eu.opsgenie.com).
. Kopieren Sie anschließend noch den API-Schlüssel und speichern Sie die Integration.

== Konfiguration Checkmk
Für die Anbindung genügt in Checkmk nun die Angabe der beiden kopierten Daten:

. Wählen Sie als [.guihints]#Notification Method# den Punkt [.guihints]#Opsgenie.}}# 
. Tragen Sie unter [.guihints]#API Key to use.# den kopierten Schlüssel ein.
. Aktivieren Sie -- als EU-Nutzer -- den Punkt [.guihints]#Domain# und fügen Sie die kopierte Domain ein.

image::bilder/notifications_opsgenie.png[]

Zum Testen können Sie die [commands|Kommandos] nutzen und etwa einen Host über
[.guihints]#Fake check results# auf (DOWN) setzen. Die Funktion [.guihints]#Custom notification# generiert an
dieser Stelle hingegen keinen Alarm in Opsgenie.

Die Konfiguration der Alarmierungsmethode Opsgenie bietet Ihnen allerlei weitere
Optionen, insbesondere zum Anreichern und Ändern der Standardinhalte der
Benachrichtigungen. Darüber hinaus können Sie über den Punkt
[.guihints]#Responsible teams# das Opsgenie-Team festlegen, wenn Sie nicht wie hier
beschrieben speziell für ein Team, sondern für den gesamten Opsgenie-Acccount
integriert haben -- was wiederum nur bei bestimmten Subskriptionen möglich ist.

COMMENT[ML: Custom Actions: Was genau kommt da hin und was macht das? Testeingabe foobar war weder in der Notification innerhalb von Checkmk noch in Opsgenie zu sehen. Im Zweifel auslassen, da eher Opsgenie-Angelegenheit.]

COMMENT[SK: Ich bin mir ziemlich sicher, dass es hier im "Opsgenie Actions" geht. Die kann man in Opsgenie definieren und dann auch von außen anstoßen. Siehe: https://youtu.be/7l8slo_Z1HM]

COMMENT[ML: Der API-Schlüssel wird als Asterisks angezeigt - besser wäre als normaler Text, wie es auch beim Schlüssel von PagerDuty ist.]
