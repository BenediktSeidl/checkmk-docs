// -*- coding: utf-8 -*-
include::../global_attr.adoc[]


[#installation]
== Installation

{CMK} bietet Ihnen für die Installation des Linux-Agenten verschiedene Wege -- von der manuellen Installation des Software-Pakets bis hin zum vollautomatischen Deployment inklusive Updatefunktion.
Manche davon stehen nur in den {EE} zur Verfügung:

[cols="40,50,~,~",options="header"]
|===
|Methode |Beschreibung |CRE |CEE
|Mitgeliefertes RPM/DEB-Paket |Einfache Installation eines Standard-Agenten mit manueller Konfiguration über Konfigurationsdateien. |X |X
|RPM/DEB-Paket aus der xref:wato_monitoringagents#bakery[Agentenbäckerei] |Konfiguration über die GUI, individuelle Konfiguration pro Host möglich. | |X
|xref:agent_deployment#[Automatisches Updaten] |Das Paket aus der Agentenbäckerei wird erstmalig von Hand oder per Skript installiert und von da an automatisch aktualisiert. | |X
// |Manuelle Installation |Sie kopieren die Einzeldateien ohne Paket auf das Zielsystem und setzen `xinetd`, `systemd`, SSH oder eine eigene Zugriffssmethode von Hand auf. |X |X
|===


[#prerequisites]
=== Voraussetzungen

// Systemd


[#download]
=== Download des RPM/DEB-Pakets

Sie installieren den Linux-Agenten durch Installation des RPM- oder des DEB-Pakets.
Ob Sie RPM oder DEB benötigen, hängt von der Linux-Distribution ab, auf der Sie das Paket installieren möchten:

[cols="10,10,~",options="header"]
|===
|Paket |Endung |Installation auf
|RPM |`.rpm` |Red Hat Enterprise Linux, Fedora, CentOS, openSUSE, SLES, Derivate davon
|DEB |`.deb` |Debian, Ubuntu, alle anderen DEB-basierten Distributionen
|===

Vor der Installation müssen Sie das Paket holen und auf den Host bringen (zum Beispiel mit `scp` oder WinSCP), auf dem der Agent laufen soll.
 

==== Paket per {CMK}-GUI holen

In der {CRE} finden Sie die Linux-Pakete des Agenten über [.guihint]#Setup > Agents > Linux#.
In den {EE} gelangen Sie im Setup-Menü über [.guihint]#Agents > Windows, Linux, Solaris, AIX# zunächst in die xref:wato_monitoringagents#[Agentenbäckerei].
Von dort aus kommen Sie mit dem Menüpunkt [.guihint]#Related > Linux, Solaris, AIX files# zur Liste der Agentendateien:

image::agent_linux_agent_files.png[]

Alles was Sie brauchen, finden Sie gleich im ersten Kasten mit dem Namen [.guihint]#Packaged Agents#.
Dort finden Sie fertige RPM- und DEB-Pakete für die Installation des Linux-Agenten mit Standardeinstellungen.

// Achtung: Im Kasten [.guihint]#Agents# finden Sie die reinen Agentenskripten für die xref:agent_linux#manual[manuelle Installation] nach `/usr/bin/`.
// Verwenden Sie diese nur, wenn die paketierten Agenten bei Ihnen nicht funktionieren.


==== Paket per HTTP holen

Manchmal ist der Download auf einen Rechner und das anschließende Kopieren auf den Zielrechner mit `scp` oder WinSCP sehr umständlich.
Sie können das Paket vom {CMK}-Server auch direkt per HTTP auf das Zielsystem laden.
Für diesen Zweck sind die Downloads der Agentendateien bewusst _ohne Anmeldung_ möglich.
Immerhin enthalten die Dateien keine Geheimnisse.
Jeder kann sich {CMK} selbst herunterladen und installieren und so auf die Dateien zugreifen.

Am einfachsten geht das mit `wget`.
Die URL können Sie über den Browser ermitteln.
Wenn Sie den Namen des Pakets bereits kennen, können Sie die URL einfach selbst zusammensetzen.
Setzen Sie einfach `/mysite/check_mk/agents/` vor den Dateinamen, im folgenden Beispiel für das RPM-Paket:

// TK: Dateiname checken
[{shell-raw}]
----
{c-root} wget http://mycmkserver/mysite/check_mk/agents/check-mk-agent-2.1.0i1-1.noarch.rpm
----

*Tipp:* RPM hat sogar ein eingebautes `wget`.
Hier können Sie Download und xref:install_paket[Installation] mit einem Kommando durchführen:

// TK: Dateiname checken
[{shell-raw}]
----
{c-root} rpm -U http://mycmkserver/mysite/check_mk/agents/check-mk-agent-2.1.0i1-1.noarch.rpm
----


==== Paket per REST-API holen

Die xref:rest_api#[REST-API] von {CMK} bietet seit der Version {v20}p18 die folgenden Möglichkeiten Agentenpakete vom {CMK}-Server herunterzuladen:

* Herunterladen des mitgelieferten Agenten.
* Herunterladen eines gebackenen Agenten nach Host-Name und Betriebssystem.
* Herunterladen eines gebackenen Agenten nach Hash des Agenten und Betriebsystems.

Auch per REST-API haben Sie die Möglichkeit, das Paket vom {CMK}-Server direkt auf den Zielrechner zu holen.
Das mitgelieferte DEB-Paket des Linux-Agenten lässt sich beispielsweise wie folgt holen:

// TK: URL checken
[{shell}]
----
{c-root} curl -OJG 'http://mycmkserver/mysite/check_mk/api/1.0/domain-types/agent/actions/download/invoke' \
--data-urlencode 'os_type=linux_deb' \
-H 'accept: application/octet-stream' \
-H 'Authorization: Bearer automation myautomationsecret'
----

Hierbei handelt es sich nur um ein sehr einfaches Beispiel um die Funktionweise dieses einen Endpunkts der REST-API zu demonstrieren.
Details zu der Funktionsweise der Endpunkte zum Herunterladen des Agenten finden Sie in der in {CMK} verfügbaren API-Dokumentation, die Sie über [.guihint]#Help > Devloper resources > REST API documenation# aufrufen können.


[#install_paket]
=== RPM/DEB-Paket installieren

Nachdem Sie das RPM- oder das DEB-Paket geholt und -- falls nötig -- mit `scp`, WinSCP oder anderen Mitteln auf den zu überwachenden Host kopiert haben, ist die Installation mit einem Kommando erledigt.

Die Installation des RPM-Pakets erfolgt unter `root` mit dem Befehl `rpm -U`:

// TK: Dateiname checken
[{shell}]
----
{c-root} rpm -U check-mk-agent-2.1.0i1-1.noarch.rpm
----

Die Option `-U` steht übrigens für „Update“, kann aber auch eine Erstinstallation korrekt durchführen.
Das bedeutet auch, dass Sie mit diesem Befehl einen bereits installierten Agenten auf die neue Version updaten können -- und ihn auch zukünftig für Updates des Agentenpakets nutzen können.

Die Installation des DEB-Pakets -- und ein Update -- erfolgt unter `root` mit dem Befehl `dpkg -i`:

// TK: Dateiname checken
[{shell}]
----
{c-root} dpkg -i check-mk-agent-2.1.0i1-1_all.deb
----

// TK: Nachinstallation von xinetd kein Thema mehr, oder?
// TK: Keine manuelle Installation

=== Installation mit der Agentenbäckerei

{cee-only}
Die {CEE} verfügen mit der xref:wato_monitoringagents#bakery[Agentenbäckerei] über ein Setup-Modul zum automatischen Paketieren von individuell angepassten Agenten.
Dieses wird im allgemeinen Kapitel über die xref:wato_monitoringagents#[Agenten] beschrieben.
Die Installation der gebackenen Pakete geschieht genauso wie es für die mitgelieferten Pakete xref:install_paket[oben] beschrieben ist.


=== Automatischer Update
{cee-only}
Wenn Sie die Agentenbäckerei verwenden, können Sie automatische Updates des Agenten einrichten.
Diese werden in einem xref:agent_deployment#[eigenen Artikel] beschrieben.


=== Deinstallation

