:revdate: draft

== Backups
=== Grundlagen

Im Laufe der Zeit werden Sie einiges an Arbeit in die genaue
Konfiguration Ihrer Hosts und Services, Grenzwerte, Alarmierungen
und so weiter stecken -- daher sollten Sie Backups erstellen.
Das ist nicht nur nützlich für den Fall, dass etwas schiefgeht,
sondern auch zum Testen oder Nutzen unterschiedlicher
Konfigurationen. Sie können die komplette Konfiguration über das
WATO-Modul [.guihints]#Backups# sichern und bei Bedarf auch wieder
zurückspielen. Backups lassen sich zeitgesteuert ausführen, verschlüsseln und komprimieren.

=== Verschlüsselte, komprimierte Backups konfigurieren
Im ersten Schritt legen Sie über [.guihints]#WATO => Backups => Backup targets => Newbackup target}}# 
ein neues Backupziel an. Die absolute Pfadangabe bezieht sich auf das System, nicht auf die Instanz.

image::bilder/backup_target_config.png[]

Erstellen Sie anschließend einen neuen Schlüssel für Ihre Backups
über ICON[icon_backup_keys.png] mit einem aussagekräftigen Namen
und einem sicheren Passwort.

image::bilder/backup_key_config.png[]

*Achtung:* Nach dem Erstellen des Schlüssels werden Sie eine
Warnmeldung sehen, die Sie darauf hinweist, dass Sie die Schlüssel
noch nicht heruntergeladen haben. Da Sie diese Schlüssel für die
Wiederherstellung von Backups zwingend benötigen, verbleibt die
Meldung bis alle Schlüssel gesichert wurden.

image::bilder/backup_key_warning.png[]

Nun können Sie über ICON[icon_backup_newjob.png] einen neuen Sicherungsauftrag erstellen und unter anderem die eben erstellten Elemente unter [.guihints]#Target# beziehungsweise [.guihints]#Encryption# wählen. Zudem finden Sie hier Optionen für die Komprimierung und die zeitliche Backupplanung. Wie Sie gleich sehen werden, können Sie Backups aber auch manuell anstoßen. Über [.guihints]#Do not backup historical data# lassen sich Metriken (RRD-Dateien), Monitoringverlauf und Logdateien einsparen, was zu deutlich kleineren Backuparchiven führt.

image::bilder/backup_job_config.png[]

=== Backups erstellen

Wieder zurück auf der Startseite des Backupmoduls sehen Sie nun Ihren fertigen Backupauftrag und können ihn über ICON[icon_backup_start.png] starten:

image::bilder/backup_job_play.png[align=border]

Laufende Backups können Sie über ICON[icon_backup_stop.png] stoppen:

image::bilder/backup_job_running.png[align=border]

Zu guter Letzt sehen Sie die Bestätigung des fertiggestellten Backups:

image::bilder/backup_job_finished.png[align=border]

Sowohl bei laufenden als auch bei abgeschlossenen Aufträgen gelangen Sie über ICON[icon_backup_state.png] zu einer ausführlichen Statusmeldung.

=== Backups zurückspielen
Die Wiederherstellung von Backups starten Sie über ICON[icon_backup_restore.png], das Vorgehen ist weitestgehend selbsterklärend:

. Wählen Sie den Backupauftrag.
. Wählen Sie die gewünschte Backupdatei.
. Starten und autorisieren Sie den Vorgang mit dem Backupschlüssel.

Nach der Wiederherstellung wird die Instanz neu gestartet, daher sehen Sie kurzzeitig eine 503-Fehlermeldung:

image::bilder/backup_restore_warning.png[]

Sobald die Instanz wieder ferfügbar ist bekommen Sie eine ausführliche Statusmeldung über das erfolgreiche Backup:

image::bilder/backup_restore_finished.png[align=border]













